---
title: 5.2 - Planning & Navigation
sidebar_position: 2
id: lesson-5-2-planning-and-navigation
---

import Admonition from '@theme/Admonition';

# 5.2 - Planning & Navigation

## What You'll Learn

For a mobile robot to operate autonomously, it must be able to plan its movements from a starting point to a goal while avoiding obstacles. This lesson delves into the fundamental algorithms and techniques used for **path planning** and **navigation**, culminating in an understanding of the powerful ROS 2 Nav2 stack.

## The Motion Planning Problem

At its core, motion planning is about finding a sequence of valid configurations (poses) for a robot to move from a start configuration to a goal configuration. A "valid" configuration typically means one where the robot does not collide with obstacles or itself.

### Key Components

-   **Start Pose:** The robot's initial position and orientation.
-   **Goal Pose:** The desired final position and orientation.
-   **Obstacles:** Static (walls, furniture) and dynamic (moving people, other robots) elements to be avoided.
-   **Map:** An environmental representation (e.g., occupancy grid map from SLAM).

## Path Planning Algorithms

Path planning can be broadly divided into global and local planning.

### 1. Global Path Planning: The Big Picture

Global planners calculate an optimal or near-optimal path from the start to the goal, assuming a complete and accurate map of the environment. This path is often a series of waypoints or a geometric trajectory.

-   **Grid-Based Search Algorithms:**
    -   **Dijkstra's Algorithm:** Finds the shortest path between nodes in a graph. Guarantees optimality but can be slow on large grids.
    -   **A\* (A-Star) Search:** An extension of Dijkstra's that uses a heuristic function to guide the search towards the goal, making it much more efficient. It finds the shortest path given the heuristic.
        -   **Heuristic:** An estimated cost from the current node to the goal. For grid-based navigation, this is often Manhattan distance or Euclidean distance.
-   **Sampling-Based Planners (for High-Dimensional Spaces):**
    -   **Rapidly-exploring Random Tree (RRT/RRT\*):** Explores the configuration space by incrementally building a tree of possible paths. Useful for complex, high-dimensional robots (e.g., robotic arms). RRT\* is an optimized version that attempts to find optimal paths.
    -   **Probabilistic Roadmaps (PRM):** Constructs a roadmap of free-space connections by sampling random configurations and connecting them if collision-free.

### 2. Local Path Planning: Real-time Obstacle Avoidance

Local planners operate in real-time, considering immediate sensor readings and dynamic obstacles to follow the global path safely. They often make small, frequent adjustments to the robot's velocity commands.

-   **Dynamic Window Approach (DWA):**
    -   **Concept:** Samples a set of possible robot velocities (linear and angular) within a "dynamic window" (considering motor limits and current velocity).
    -   For each sampled velocity, it simulates the robot's trajectory for a short time and evaluates it based on criteria like:
        -   Distance to obstacles.
        -   Progress towards the goal.
        -   Distance to the global path.
        -   Robot's velocity.
    -   The velocity with the highest score is chosen.
    -   **Benefit:** Very effective for smooth, real-time obstacle avoidance.

## The ROS 2 Nav2 Stack

**Nav2** is the official navigation framework for ROS 2. It's a collection of ROS 2 packages that implement a full navigation system for mobile robots. It leverages many of the concepts we've discussed.

### Key Components of Nav2

1.  **Map Server:** Provides the environment map (e.g., an occupancy grid map generated by SLAM) to other Nav2 components.
2.  **AMCL (Adaptive Monte Carlo Localization):** A particle filter-based localization algorithm that estimates the robot's pose within a known 2D map.
3.  **Global Planner:** Implements algorithms like A\* or Dijkstra's to compute an optimal path from the robot's current pose to the goal pose on the map.
4.  **Local Planner (Controller):** Implements algorithms like DWA to generate velocity commands to follow the global path and avoid local obstacles.
5.  **Behavior Tree (BT) Navigator:** Nav2 uses a Behavior Tree to coordinate various navigation behaviors (e.g., "go to goal," "recover from collision," "clear costmap"). This will be explored in Lesson 5.3.
6.  **Costmaps:**
    -   **Definition:** Grid-based representations of the environment that provide information about obstacles, inflation layers (safety margins around obstacles), and unknown areas.
    -   **Global Costmap:** Used by the global planner, built from the static map.
    -   **Local Costmap:** Used by the local planner, built from real-time sensor data.

## Hands-On: Navigating a Simulated Robot with Nav2

We will use the Nav2 stack to make a simulated TurtleBot3 robot autonomously navigate to a goal in Gazebo.

### Step 1: Install Nav2

```bash
sudo apt update
sudo apt install ros-humble-navigation2 ros-humble-nav2-bringup
```

### Step 2: Launch the Nav2 Demo

In a new terminal (sourced for ROS 2):

```bash
ros2 launch turtlebot3_navigation2 navigation2.launch.py use_sim_time:=True map:=/opt/ros/humble/share/turtlebot3_navigation2/maps/map.yaml
```
This command does a lot:
-   Launches Gazebo with a TurtleBot3 robot.
-   Starts the Nav2 stack (map server, AMCL, global/local planners, etc.).
-   Loads a pre-built map (`map.yaml`).

### Step 3: Set a Navigation Goal in RViz2

1.  After the launch command, `rviz2` should automatically start and display the map and robot.
2.  In `rviz2`, click the `2D Pose Estimate` button (looks like a robot with a green arrow). Click on the map near the robot's actual position in Gazebo to set its initial pose estimate. This helps AMCL localize the robot.
3.  Click the `2D Goal Pose` button (looks like a green arrow with a red square). Click on the map to select a target location, and then drag to set the desired orientation.

Observe the robot in Gazebo. It should calculate a path (visible as a colored line in `rviz2`) and start moving towards the goal, avoiding obstacles!

## Challenges

1.  **Explore Planners:** In `rviz2`, under the `Global Planner` and `Local Planner` displays, try changing some of their parameters (e.g., `planner_id` or `controller_id` to switch between different algorithms if available).
2.  **Dynamic Obstacles:** Introduce a dynamic obstacle (e.g., another simple box that moves) into the Gazebo world. Observe how the robot's local planner (DWA) reacts to avoid it.
3.  **Path Following vs. Obstacle Avoidance:** For a local planner like DWA, there is a trade-off between aggressively following the global path and avoiding local obstacles. How would you prioritize one over the other in different scenarios?
4.  **Explore Map Types:** Research how Nav2 can use different types of maps (e.g., point clouds from 3D sensors). What would be the advantages and disadvantages?
